(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,64659,e=>{"use strict";let t=(0,e.i(75254).default)("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);e.s(["ChevronDown",()=>t],64659)},63059,e=>{"use strict";let t=(0,e.i(75254).default)("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);e.s(["ChevronRight",()=>t],63059)},13920,e=>{"use strict";var t=e.i(43476),s=e.i(71645),a=e.i(7471),r=e.i(64659),d=e.i(63059);let i=(0,e.i(75254).default)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);function o(){let[e,o]=(0,s.useState)([]),[c,n]=(0,s.useState)(!0),[l,u]=(0,s.useState)({}),[m,p]=(0,s.useState)(null);async function x(){let{data:e}=await a.supabase.from("products").select(`
                id, name, stock, 
                product_variants(id),
                product_combinations(id, attributes, stock)
            `).order("name",{ascending:!0});e&&o(e),n(!1)}(0,s.useEffect)(()=>{x()},[]);let h=async(e,t,s)=>{let r=parseInt(s);if(!isNaN(r)){p(t||e);try{t?(await a.supabase.from("product_combinations").update({stock:r}).eq("id",t),o(s=>s.map(s=>{if(s.id===e){let d=s.product_combinations.map(e=>e.id===t?{...e,stock:r}:e),i=d.reduce((e,t)=>e+t.stock,0);return a.supabase.from("products").update({stock:i}).eq("id",e).then(),{...s,stock:i,product_combinations:d}}return s}))):(await a.supabase.from("products").update({stock:r}).eq("id",e),o(t=>t.map(t=>t.id===e?{...t,stock:r}:t)))}catch(e){console.error(e),alert("Error al actualizar stock")}finally{p(null)}}};return(0,t.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"Control de Stock"}),(0,t.jsxs)("div",{className:"bg-card rounded-lg border shadow-sm overflow-hidden",children:[(0,t.jsxs)("div",{className:"grid grid-cols-[auto_1fr_auto] gap-4 p-4 border-b bg-muted/20 font-medium",children:[(0,t.jsx)("div",{className:"w-8"}),(0,t.jsx)("div",{children:"Producto"}),(0,t.jsx)("div",{className:"w-32 text-right",children:"Stock Total"})]}),c?(0,t.jsx)("div",{className:"p-8 text-center text-muted-foreground",children:"Cargando..."}):(0,t.jsx)("div",{className:"divide-y",children:e.map(e=>{let s=e.product_combinations&&e.product_combinations.length>0,a=l[e.id];return(0,t.jsxs)("div",{className:"group",children:[(0,t.jsxs)("div",{className:`grid grid-cols-[auto_1fr_auto] gap-4 p-4 items-center hover:bg-muted/5 transition-colors ${a?"bg-muted/5":""}`,children:[(0,t.jsx)("div",{className:"w-8 flex justify-center",children:s&&(0,t.jsx)("button",{onClick:()=>{var t;return t=e.id,void u(e=>({...e,[t]:!e[t]}))},className:"p-1 hover:bg-muted rounded text-muted-foreground",children:a?(0,t.jsx)(r.ChevronDown,{className:"h-4 w-4"}):(0,t.jsx)(d.ChevronRight,{className:"h-4 w-4"})})}),(0,t.jsx)("div",{className:"font-medium",children:e.name}),(0,t.jsx)("div",{className:"w-32 flex justify-end",children:s?(0,t.jsx)("span",{className:"font-bold text-lg",children:e.stock}):(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("input",{type:"number",className:"w-20 px-2 py-1 text-right border rounded bg-background text-foreground",defaultValue:e.stock,onBlur:t=>h(e.id,null,t.target.value)}),m===e.id&&(0,t.jsx)(i,{className:"h-3 w-3 animate-pulse text-primary"})]})})]}),a&&s&&(0,t.jsxs)("div",{className:"bg-muted/10 border-t border-b px-12 py-4",children:[(0,t.jsx)("div",{className:"text-xs font-semibold uppercase text-muted-foreground mb-2 tracking-wider",children:"Variantes"}),(0,t.jsx)("div",{className:"space-y-2",children:e.product_combinations.map(s=>(0,t.jsxs)("div",{className:"flex items-center justify-between p-2 bg-background border rounded-md max-w-md ml-auto",children:[(0,t.jsx)("div",{className:"text-sm flex gap-2",children:Object.entries(s.attributes).map(([e,s])=>(0,t.jsxs)("span",{className:"bg-muted px-1.5 py-0.5 rounded text-xs",children:[e,": ",(0,t.jsx)("span",{className:"font-medium",children:s})]},e))}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("input",{type:"number",className:"w-16 px-2 py-1 text-right border rounded text-sm bg-background text-foreground",defaultValue:s.stock,onBlur:t=>h(e.id,s.id,t.target.value)}),(0,t.jsx)("div",{className:"w-4",children:m===s.id&&(0,t.jsx)(i,{className:"h-3 w-3 animate-pulse text-primary"})})]})]},s.id))})]})]},e.id)})})]})]})}e.s(["default",()=>o],13920)},75562,e=>{e.n(e.i(13920))}]);