(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,37727,e=>{"use strict";let t=(0,e.i(75254).default)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);e.s(["X",()=>t],37727)},71689,69074,e=>{"use strict";var t=e.i(75254);let a=(0,t.default)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",()=>a],71689);let r=(0,t.default)("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]]);e.s(["Upload",()=>r],69074)},89497,e=>{"use strict";var t=e.i(43476),a=e.i(71645),r=e.i(7471),s=e.i(18566),l=e.i(71689),d=e.i(69074),i=e.i(37727);function o(){(0,s.useRouter)();let e=(0,s.useSearchParams)().get("id"),[o,n]=(0,a.useState)(!0),[c,u]=(0,a.useState)(!1),[m,p]=(0,a.useState)([]),[b,x]=(0,a.useState)([]),[h,g]=(0,a.useState)(""),[f,j]=(0,a.useState)(""),[v,y]=(0,a.useState)(""),[N,w]=(0,a.useState)("0"),[k,_]=(0,a.useState)(""),[S,C]=(0,a.useState)(""),[E,q]=(0,a.useState)("0"),[M,P]=(0,a.useState)(!1),[O,A]=(0,a.useState)(!1),[U,R]=(0,a.useState)(""),[T,I]=(0,a.useState)([]),[L,X]=(0,a.useState)([]),[z,B]=(0,a.useState)([]),[G,V]=(0,a.useState)([]),[$,D]=(0,a.useState)([]),[F,H]=(0,a.useState)([]);async function K(){var t;let a,{data:s}=await r.supabase.from("categories").select("*"),{data:l}=await r.supabase.from("brands").select("*");s&&p(s),l&&x(l);let{data:d,error:i}=await r.supabase.from("products").select("*, product_images(*), product_variants(*), product_combinations(*)").eq("id",e).single();if(i||!d){alert("Producto no encontrado"),window.location.href="/admin/products";return}g((t=d).name),j(t.description||""),y(t.price.toString()),w(t.priority?.toString()||"0"),_(t.category_id||""),C(t.brand_id||""),q(t.stock?.toString()||"0"),P(t.is_new||!1),A(t.is_on_sale||!1),R(t.original_price?.toString()||""),(a=t.product_images||[]).sort((e,t)=>(e.display_order||0)-(t.display_order||0)),B(a),V(t.product_variants||[]),t.product_combinations&&t.product_combinations.length>0&&H(t.product_combinations),n(!1)}(0,a.useEffect)(()=>{e?K():window.location.href="/admin/products"},[e]);let W=async e=>{if(!confirm("¿Eliminar esta imagen?"))return;let{error:t}=await r.supabase.from("product_images").delete().eq("id",e);t?alert("Error al borrar imagen"):B(t=>t.filter(t=>t.id!==e))},J=(e,t,a)=>{let r=[...$];r[e][t]=a,D(r)},Q=async e=>{let t=[...G];V(t=>t.filter(t=>t.id!==e));let{error:a}=await r.supabase.from("product_variants").delete().eq("id",e);a&&(alert("Error al borrar variante"),V(t))},Y=async t=>{t.preventDefault(),u(!0);try{let t=F.length>0?F.reduce((e,t)=>e+t.stock,0):parseInt(E)||0,{error:a}=await r.supabase.from("products").update({name:h,description:f,price:parseFloat(v),priority:parseInt(N)||0,category_id:k||null,brand_id:S||null,is_new:M,is_on_sale:O,original_price:O&&U?parseFloat(U):null,stock:t}).eq("id",e);if(a)throw a;if(T.length>0){let t=z.reduce((e,t)=>Math.max(e,t.display_order||0),0);for(let a=0;a<T.length;a++){let s=T[a],l=s.name.split(".").pop(),d=`${e}/${Math.random()}.${l}`,{error:i}=await r.supabase.storage.from("products").upload(d,s);if(i)throw i;let{data:o}=r.supabase.storage.from("products").getPublicUrl(d);await r.supabase.from("product_images").insert({product_id:e,url:o.publicUrl,display_order:t+1+a})}}if($.length>0){let t=$.filter(e=>""!==e.type.trim()&&""!==e.value.trim());if(t.length>0){let{error:a}=await r.supabase.from("product_variants").insert(t.map(t=>({product_id:e,type:t.type,value:t.value})));if(a)throw a}}if(F.length>0){let t=F.map(e=>e.id).filter(e=>e&&!e.startsWith("temp-")),{data:a}=await r.supabase.from("product_combinations").select("id").eq("product_id",e);if(a){let e=a.filter(e=>!t.includes(e.id));if(e.length>0){let{error:t}=await r.supabase.from("product_combinations").delete().in("id",e.map(e=>e.id));t&&console.error("Error deleting old combos:",t)}}for(let t of F)if(t.id&&!t.id.startsWith("temp-")){let{error:e}=await r.supabase.from("product_combinations").update({stock:t.stock,attributes:t.attributes}).eq("id",t.id);if(e)throw e}else{let{error:a}=await r.supabase.from("product_combinations").insert({product_id:e,attributes:t.attributes,stock:t.stock});if(a)throw a}}else await r.supabase.from("product_combinations").delete().eq("product_id",e);window.location.href="/admin/products"}catch(e){alert("Error: "+e.message)}finally{u(!1)}};return o?(0,t.jsx)("div",{className:"p-8 text-center bg-card rounded-lg",children:"Cargando..."}):(0,t.jsxs)("div",{className:"max-w-2xl mx-auto",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4 mb-6",children:[(0,t.jsx)("a",{href:"/admin/products",className:"p-2 hover:bg-muted rounded-full text-foreground",children:(0,t.jsx)(l.ArrowLeft,{className:"h-5 w-5"})}),(0,t.jsx)("h1",{className:"text-2xl font-bold",children:"Editar Producto"})]}),(0,t.jsxs)("form",{onSubmit:Y,className:"space-y-6 bg-card p-6 rounded-lg border shadow-sm",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"col-span-2",children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Nombre del Producto"}),(0,t.jsx)("input",{required:!0,type:"text",className:"w-full px-3 py-2 rounded-md border bg-background",value:h,onChange:e=>g(e.target.value)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Precio"}),(0,t.jsx)("input",{required:!0,type:"number",className:"w-full px-3 py-2 rounded-md border bg-background",value:v,onChange:e=>y(e.target.value)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Prioridad (Orden)"}),(0,t.jsx)("input",{type:"number",placeholder:"0",className:"w-full px-3 py-2 rounded-md border bg-background",value:N,onChange:e=>w(e.target.value)}),(0,t.jsx)("p",{className:"text-[10px] text-muted-foreground mt-1",children:"Mayor número = Aparece primero."})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Categoría"}),(0,t.jsxs)("select",{className:"w-full px-3 py-2 rounded-md border bg-background",value:k,onChange:e=>_(e.target.value),children:[(0,t.jsx)("option",{value:"",children:"Seleccionar..."}),m.map(e=>(0,t.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Marca"}),(0,t.jsxs)("select",{className:"w-full px-3 py-2 rounded-md border bg-background",value:S,onChange:e=>C(e.target.value),children:[(0,t.jsx)("option",{value:"",children:"Seleccionar..."}),b.map(e=>(0,t.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),0===F.length&&(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Stock Base"}),(0,t.jsx)("input",{type:"number",className:"w-full px-3 py-2 rounded-md border bg-background",value:E,onChange:e=>q(e.target.value)})]})]}),(0,t.jsxs)("div",{className:"border-t pt-4",children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-3",children:"Etiquetas de Producto"}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("label",{className:"flex items-center gap-3 cursor-pointer",children:[(0,t.jsx)("input",{type:"checkbox",checked:M,onChange:e=>P(e.target.checked),className:"w-4 h-4 rounded border-border accent-primary"}),(0,t.jsxs)("span",{className:"text-sm",children:["Marcar como ",(0,t.jsx)("span",{className:"bg-emerald-500 text-white text-xs px-2 py-0.5 rounded ml-1",children:"Nuevo"})]})]}),(0,t.jsxs)("label",{className:"flex items-center gap-3 cursor-pointer",children:[(0,t.jsx)("input",{type:"checkbox",checked:O,onChange:e=>A(e.target.checked),className:"w-4 h-4 rounded border-border accent-primary"}),(0,t.jsxs)("span",{className:"text-sm",children:["Marcar como ",(0,t.jsx)("span",{className:"bg-red-500 text-white text-xs px-2 py-0.5 rounded ml-1",children:"Oferta"})]})]}),O&&(0,t.jsxs)("div",{className:"ml-7",children:[(0,t.jsx)("label",{className:"block text-sm text-muted-foreground mb-1",children:"Precio Original (tachado)"}),(0,t.jsx)("input",{type:"number",placeholder:"Ej: 300000",className:"w-40 px-3 py-2 rounded-md border bg-background text-sm",value:U,onChange:e=>R(e.target.value)})]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Descripción"}),(0,t.jsx)("textarea",{className:"w-full px-3 py-2 rounded-md border bg-background min-h-[100px]",value:f,onChange:e=>j(e.target.value)})]}),(0,t.jsxs)("div",{className:"border-t pt-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsx)("label",{className:"block text-sm font-medium",children:"Variantes"}),(0,t.jsxs)("button",{type:"button",onClick:()=>{D([...$,{type:"",value:""}])},className:"text-sm text-primary hover:underline flex items-center gap-1",children:[(0,t.jsx)(d.Upload,{className:"h-3 w-3 rotate-90"})," Agregar Variante"]})]}),(0,t.jsxs)("div",{className:"space-y-2 mb-4",children:[G.map(e=>(0,t.jsxs)("div",{className:"flex gap-2 items-center bg-muted/20 p-2 rounded",children:[(0,t.jsxs)("span",{className:"flex-1 text-sm font-medium",children:[e.type,": ",e.value]}),(0,t.jsx)("button",{type:"button",onClick:()=>Q(e.id),className:"text-destructive hover:underline text-xs",children:"Eliminar"})]},e.id)),$.map((e,a)=>(0,t.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,t.jsx)("input",{type:"text",placeholder:"Tipo (ej: Color)",className:"flex-1 px-3 py-2 rounded-md border bg-background text-sm",value:e.type,onChange:e=>J(a,"type",e.target.value)}),(0,t.jsx)("input",{type:"text",placeholder:"Valor (ej: Rojo)",className:"flex-1 px-3 py-2 rounded-md border bg-background text-sm",value:e.value,onChange:e=>J(a,"value",e.target.value)}),(0,t.jsx)("button",{type:"button",onClick:()=>{D($.filter((e,t)=>t!==a))},className:"p-2 text-destructive hover:bg-destructive/10 rounded",children:(0,t.jsx)(i.X,{className:"h-4 w-4"})})]},a))]}),(0,t.jsx)("button",{type:"button",onClick:()=>{var e;let t,a,r,s={};[...G,...$].forEach(e=>{if(e.type&&e.value){let t=e.type.trim(),a=e.value.trim();t&&a&&(s[t]||(s[t]=[]),s[t].includes(a)||s[t].push(a))}});let l=Object.keys(s);if(0===l.length){F.length>0&&confirm("Esto borrará todas las combinaciones existentes. ¿Continuar?")&&H([]);return}H((t=[],a=(e=l.map(e=>s[e])).length-1,(r=(s,l)=>{for(let d=0,i=e[l].length;d<i;d++){let i=s.slice(0);i.push(e[l][d]),l==a?t.push(i):r(i,l+1)}})([],0),t).map(e=>{let t={};l.forEach((a,r)=>{t[a]=e[r]});let a=F.find(e=>{let a=Object.keys(e.attributes),r=Object.keys(t);return a.length===r.length&&a.every(a=>e.attributes[a]===t[a])});return a||{attributes:t,stock:0}}))},className:"btn btn-secondary w-full text-sm",disabled:0===G.length&&0===$.length,children:"Generar/Actualizar Matriz de Combinaciones"})]}),F.length>0&&(0,t.jsxs)("div",{className:"border border-border rounded-md overflow-hidden bg-muted/10",children:[(0,t.jsxs)("div",{className:"p-2 bg-muted/20 font-medium text-sm border-b flex justify-between",children:[(0,t.jsx)("span",{children:"Combinación"}),(0,t.jsx)("span",{children:"Stock"})]}),(0,t.jsx)("div",{className:"divide-y divide-border/50",children:F.map((e,a)=>(0,t.jsxs)("div",{className:"p-2 flex items-center justify-between text-sm",children:[(0,t.jsx)("div",{className:"flex gap-2",children:Object.entries(e.attributes).map(([e,a])=>(0,t.jsxs)("span",{className:"bg-background border rounded px-1.5 py-0.5 text-xs text-muted-foreground",children:[e,": ",(0,t.jsx)("span",{className:"text-foreground",children:a})]},e))}),(0,t.jsx)("input",{type:"number",min:"0",className:"w-20 px-2 py-1 rounded border bg-background text-right",value:e.stock,onChange:e=>{var t;let r;return t=e.target.value,void((r=[...F])[a].stock=parseInt(t)||0,H(r))}})]},e.id||a))}),(0,t.jsxs)("div",{className:"p-2 text-xs text-right text-muted-foreground border-t",children:["Total Calculado: ",F.reduce((e,t)=>e+t.stock,0)]})]}),(0,t.jsxs)("div",{className:"border-t pt-4",children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Imágenes Existentes"}),(0,t.jsx)("div",{className:"grid grid-cols-3 sm:grid-cols-4 gap-4 mb-4",children:z.map(e=>(0,t.jsxs)("div",{className:"relative aspect-square rounded-md overflow-hidden border group",children:[(0,t.jsx)("img",{src:e.url,className:"w-full h-full object-cover"}),(0,t.jsx)("button",{type:"button",onClick:()=>W(e.id),className:"absolute top-1 right-1 bg-destructive text-white p-1 rounded-full shadow-sm opacity-0 group-hover:opacity-100 transition-opacity",title:"Eliminar imagen",children:(0,t.jsx)(i.X,{className:"h-3 w-3"})})]},e.id))}),(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Agregar Nuevas Imágenes"}),(0,t.jsxs)("div",{className:"grid grid-cols-3 sm:grid-cols-4 gap-4 mb-4",children:[L.map((e,a)=>(0,t.jsxs)("div",{className:"relative aspect-square rounded-md overflow-hidden border",children:[(0,t.jsx)("img",{src:e,className:"w-full h-full object-cover"}),(0,t.jsx)("button",{type:"button",onClick:()=>{I(e=>e.filter((e,t)=>t!==a)),X(e=>e.filter((e,t)=>t!==a))},className:"absolute top-1 right-1 bg-destructive text-white p-1 rounded-full shadow-sm hover:bg-destructive/90",children:(0,t.jsx)(i.X,{className:"h-3 w-3"})})]},a)),(0,t.jsxs)("label",{className:"aspect-square flex flex-col items-center justify-center border-2 border-dashed rounded-md cursor-pointer hover:bg-muted/50 transition-colors",children:[(0,t.jsx)(d.Upload,{className:"h-6 w-6 text-muted-foreground mb-1"}),(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:"Subir"}),(0,t.jsx)("input",{type:"file",multiple:!0,accept:"image/*",className:"hidden",onChange:e=>{if(e.target.files&&e.target.files.length>0){let t=Array.from(e.target.files);I(e=>[...e,...t]);let a=t.map(e=>URL.createObjectURL(e));X(e=>[...e,...a])}}})]})]})]}),(0,t.jsx)("div",{className:"pt-4 border-t",children:(0,t.jsx)("button",{type:"submit",disabled:c,className:"w-full btn btn-primary py-2",children:c?"Guardando...":"Guardar Cambios"})})]})]})}function n(){return(0,t.jsx)(a.Suspense,{fallback:(0,t.jsx)("div",{children:"Cargando..."}),children:(0,t.jsx)(o,{})})}e.s(["default",()=>n])}]);