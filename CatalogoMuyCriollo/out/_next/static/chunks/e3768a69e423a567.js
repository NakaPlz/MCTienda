(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,37727,e=>{"use strict";let t=(0,e.i(75254).default)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);e.s(["X",()=>t],37727)},71689,69074,e=>{"use strict";var t=e.i(75254);let a=(0,t.default)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",()=>a],71689);let s=(0,t.default)("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]]);e.s(["Upload",()=>s],69074)},30334,e=>{"use strict";var t=e.i(43476),a=e.i(71645),s=e.i(7471),r=e.i(18566),l=e.i(71689),d=e.i(69074),o=e.i(37727);function c(){(0,r.useRouter)();let[e,c]=(0,a.useState)(!1),[i,n]=(0,a.useState)([]),[u,m]=(0,a.useState)([]),[p,x]=(0,a.useState)(""),[b,h]=(0,a.useState)(""),[g,f]=(0,a.useState)(""),[j,v]=(0,a.useState)("0"),[N,y]=(0,a.useState)(""),[k,w]=(0,a.useState)(""),[C,S]=(0,a.useState)("0"),[_,M]=(0,a.useState)([]),[P,U]=(0,a.useState)([]),[O,A]=(0,a.useState)(!1),[E,q]=(0,a.useState)(!1),[R,T]=(0,a.useState)(""),[I,L]=(0,a.useState)([]),[$,B]=(0,a.useState)([]);(0,a.useEffect)(()=>{!async function(){let{data:e}=await s.supabase.from("categories").select("*"),{data:t}=await s.supabase.from("brands").select("*");e&&n(e),t&&m(t)}()},[]);let D=(e,t,a)=>{let s=[...I];s[e][t]=a,L(s)},X=async e=>{e.preventDefault(),c(!0);try{let e=$.length>0?$.reduce((e,t)=>e+t.stock,0):parseInt(C)||0,{data:t,error:a}=await s.supabase.from("products").insert({name:p,description:b,price:parseFloat(g),priority:parseInt(j)||0,category_id:N||null,brand_id:k||null,is_new:O,is_on_sale:E,original_price:E&&R?parseFloat(R):null,active:!0,stock:e}).select().single();if(a)throw a;if(!t)throw Error("No se creó el producto");if(_.length>0)for(let e=0;e<_.length;e++){let a=_[e],r=a.name.split(".").pop(),l=`${t.id}/${Math.random()}.${r}`,{error:d}=await s.supabase.storage.from("products").upload(l,a);if(d)throw d;let{data:o}=s.supabase.storage.from("products").getPublicUrl(l);await s.supabase.from("product_images").insert({product_id:t.id,url:o.publicUrl,display_order:e})}if(I.length>0){let e=I.filter(e=>""!==e.type.trim()&&""!==e.value.trim());if(e.length>0){let{error:a}=await s.supabase.from("product_variants").insert(e.map(e=>({product_id:t.id,type:e.type,value:e.value})));if(a)throw a}}if($.length>0){let{error:e}=await s.supabase.from("product_combinations").insert($.map(e=>({product_id:t.id,attributes:e.attributes,stock:e.stock})));if(e)throw e}window.location.href="/admin/products"}catch(e){alert("Error: "+e.message)}finally{c(!1)}};return(0,t.jsxs)("div",{className:"max-w-2xl mx-auto",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4 mb-6",children:[(0,t.jsx)("a",{href:"/admin/products",className:"p-2 hover:bg-muted rounded-full text-foreground",children:(0,t.jsx)(l.ArrowLeft,{className:"h-5 w-5"})}),(0,t.jsx)("h1",{className:"text-2xl font-bold",children:"Nuevo Producto"})]}),(0,t.jsxs)("form",{onSubmit:X,className:"space-y-6 bg-card p-6 rounded-lg border shadow-sm",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"col-span-2",children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Nombre del Producto"}),(0,t.jsx)("input",{required:!0,type:"text",className:"w-full px-3 py-2 rounded-md border bg-background",value:p,onChange:e=>x(e.target.value)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Precio"}),(0,t.jsx)("input",{required:!0,type:"number",className:"w-full px-3 py-2 rounded-md border bg-background",value:g,onChange:e=>f(e.target.value)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Prioridad (Orden)"}),(0,t.jsx)("input",{type:"number",placeholder:"0",className:"w-full px-3 py-2 rounded-md border bg-background",value:j,onChange:e=>v(e.target.value)}),(0,t.jsx)("p",{className:"text-[10px] text-muted-foreground mt-1",children:"Mayor número = Aparece primero."})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Categoría"}),(0,t.jsxs)("select",{className:"w-full px-3 py-2 rounded-md border bg-background",value:N,onChange:e=>y(e.target.value),children:[(0,t.jsx)("option",{value:"",children:"Seleccionar..."}),i.map(e=>(0,t.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Marca"}),(0,t.jsxs)("select",{className:"w-full px-3 py-2 rounded-md border bg-background",value:k,onChange:e=>w(e.target.value),children:[(0,t.jsx)("option",{value:"",children:"Seleccionar..."}),u.map(e=>(0,t.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),0===$.length&&(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Stock Base"}),(0,t.jsx)("input",{type:"number",className:"w-full px-3 py-2 rounded-md border bg-background",value:C,onChange:e=>S(e.target.value)})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Descripción"}),(0,t.jsx)("textarea",{className:"w-full px-3 py-2 rounded-md border bg-background min-h-[100px]",value:b,onChange:e=>h(e.target.value)})]}),(0,t.jsxs)("div",{className:"border-t pt-4",children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-3",children:"Etiquetas de Producto"}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("label",{className:"flex items-center gap-3 cursor-pointer",children:[(0,t.jsx)("input",{type:"checkbox",checked:O,onChange:e=>A(e.target.checked),className:"w-4 h-4 rounded border-border accent-primary"}),(0,t.jsxs)("span",{className:"text-sm",children:["Marcar como ",(0,t.jsx)("span",{className:"bg-emerald-500 text-white text-xs px-2 py-0.5 rounded ml-1",children:"Nuevo"})]})]}),(0,t.jsxs)("label",{className:"flex items-center gap-3 cursor-pointer",children:[(0,t.jsx)("input",{type:"checkbox",checked:E,onChange:e=>q(e.target.checked),className:"w-4 h-4 rounded border-border accent-primary"}),(0,t.jsxs)("span",{className:"text-sm",children:["Marcar como ",(0,t.jsx)("span",{className:"bg-red-500 text-white text-xs px-2 py-0.5 rounded ml-1",children:"Oferta"})]})]}),E&&(0,t.jsxs)("div",{className:"ml-7",children:[(0,t.jsx)("label",{className:"block text-sm text-muted-foreground mb-1",children:"Precio Original (tachado)"}),(0,t.jsx)("input",{type:"number",placeholder:"Ej: 300000",className:"w-40 px-3 py-2 rounded-md border bg-background text-sm",value:R,onChange:e=>T(e.target.value)})]})]})]}),(0,t.jsxs)("div",{className:"border-t pt-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsx)("label",{className:"block text-sm font-medium",children:"Definir Variantes"}),(0,t.jsxs)("button",{type:"button",onClick:()=>{L([...I,{type:"",value:""}])},className:"text-sm text-primary hover:underline flex items-center gap-1",children:[(0,t.jsx)(d.Upload,{className:"h-3 w-3 rotate-90"})," Agregar"]})]}),(0,t.jsx)("div",{className:"space-y-2 mb-4",children:I.map((e,a)=>(0,t.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,t.jsx)("input",{type:"text",placeholder:"Tipo (ej: Color)",className:"flex-1 px-3 py-2 rounded-md border bg-background text-sm",value:e.type,onChange:e=>D(a,"type",e.target.value)}),(0,t.jsx)("input",{type:"text",placeholder:"Valor (ej: Rojo)",className:"flex-1 px-3 py-2 rounded-md border bg-background text-sm",value:e.value,onChange:e=>D(a,"value",e.target.value)}),(0,t.jsx)("button",{type:"button",onClick:()=>{L(I.filter((e,t)=>t!==a))},className:"p-2 text-destructive hover:bg-destructive/10 rounded",children:(0,t.jsx)(o.X,{className:"h-4 w-4"})})]},a))}),(0,t.jsx)("button",{type:"button",onClick:()=>{var e;let t,a,s,r={};I.forEach(e=>{if(e.type&&e.value){let t=e.type.trim(),a=e.value.trim();t&&a&&(r[t]||(r[t]=[]),r[t].includes(a)||r[t].push(a))}});let l=Object.keys(r);0===l.length?B([]):B((t=[],a=(e=l.map(e=>r[e])).length-1,(s=(r,l)=>{for(let d=0,o=e[l].length;d<o;d++){let o=r.slice(0);o.push(e[l][d]),l==a?t.push(o):s(o,l+1)}})([],0),t).map((e,t)=>{let a={};return l.forEach((t,s)=>{a[t]=e[s]}),{id:`temp-${Math.random()}`,attributes:a,stock:0}}))},className:"btn btn-secondary w-full text-sm",disabled:0===I.length,children:"Generar Matriz de Combinaciones"})]}),$.length>0&&(0,t.jsxs)("div",{className:"border border-border rounded-md overflow-hidden bg-muted/10",children:[(0,t.jsxs)("div",{className:"p-2 bg-muted/20 font-medium text-sm border-b flex justify-between",children:[(0,t.jsx)("span",{children:"Combinación"}),(0,t.jsx)("span",{children:"Stock"})]}),(0,t.jsx)("div",{className:"divide-y divide-border/50",children:$.map((e,a)=>(0,t.jsxs)("div",{className:"p-2 flex items-center justify-between text-sm",children:[(0,t.jsx)("div",{className:"flex gap-2",children:Object.entries(e.attributes).map(([e,a])=>(0,t.jsxs)("span",{className:"bg-background border rounded px-1.5 py-0.5 text-xs text-muted-foreground",children:[e,": ",(0,t.jsx)("span",{className:"text-foreground",children:a})]},e))}),(0,t.jsx)("input",{type:"number",min:"0",className:"w-20 px-2 py-1 rounded border bg-background text-right",value:e.stock,onChange:e=>{var t;let s;return t=e.target.value,void((s=[...$])[a].stock=parseInt(t)||0,B(s))}})]},e.id))}),(0,t.jsxs)("div",{className:"p-2 text-xs text-right text-muted-foreground border-t",children:["Total Calculado: ",$.reduce((e,t)=>e+t.stock,0)]})]}),(0,t.jsxs)("div",{className:"border-t pt-4",children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Imágenes"}),(0,t.jsxs)("div",{className:"grid grid-cols-3 sm:grid-cols-4 gap-4 mb-4",children:[P.map((e,a)=>(0,t.jsxs)("div",{className:"relative aspect-square rounded-md overflow-hidden border",children:[(0,t.jsx)("img",{src:e,className:"w-full h-full object-cover"}),(0,t.jsx)("button",{type:"button",onClick:()=>{M(e=>e.filter((e,t)=>t!==a)),U(e=>e.filter((e,t)=>t!==a))},className:"absolute top-1 right-1 bg-destructive text-white p-1 rounded-full shadow-sm hover:bg-destructive/90",children:(0,t.jsx)(o.X,{className:"h-3 w-3"})})]},a)),(0,t.jsxs)("label",{className:"aspect-square flex flex-col items-center justify-center border-2 border-dashed rounded-md cursor-pointer hover:bg-muted/50 transition-colors",children:[(0,t.jsx)(d.Upload,{className:"h-6 w-6 text-muted-foreground mb-1"}),(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:"Subir"}),(0,t.jsx)("input",{type:"file",multiple:!0,accept:"image/*",className:"hidden",onChange:e=>{if(e.target.files&&e.target.files.length>0){let t=Array.from(e.target.files);M(e=>[...e,...t]);let a=t.map(e=>URL.createObjectURL(e));U(e=>[...e,...a])}}})]})]})]}),(0,t.jsx)("div",{className:"pt-4 border-t",children:(0,t.jsx)("button",{type:"submit",disabled:e,className:"w-full btn btn-primary py-2",children:e?"Guardando...":"Crear Producto"})})]})]})}e.s(["default",()=>c])}]);